"use strict";var BugDispatch={options:{minDelay:500,maxDelay:1e4,minBugs:2,maxBugs:20,minSpeed:5,maxSpeed:10,maxLargeTurnDeg:150,maxSmallTurnDeg:10,maxWiggleDeg:5,imageSprite:"fly-sprite.png",bugWidth:13,bugHeight:14,num_frames:5,zoom:10,canFly:!0,canDie:!0,numDeathTypes:3,monitorMouseMovement:!1,eventDistanceToBug:40,minTimeBetweenMultipy:1e3,mouseOver:"random"},initialize:function(t){if(this.options=mergeOptions(this.options,t),this.options.minBugs>this.options.maxBugs&&(this.options.minBugs=this.options.maxBugs),this.modes=["multiply","nothing"],this.options.canFly&&this.modes.push("fly","flyoff"),this.options.canDie&&this.modes.push("die"),-1==this.modes.indexOf(this.options.mouseOver)&&(this.options.mouseOver="random"),this.transform=null,this.transforms={Moz:function(t){this.bug.style.MozTransform=t},webkit:function(t){this.bug.style.webkitTransform=t},O:function(t){this.bug.style.OTransform=t},ms:function(t){this.bug.style.msTransform=t},Khtml:function(t){this.bug.style.KhtmlTransform=t},w3c:function(t){this.bug.style.transform=t}},"transform"in document.documentElement.style)this.transform=this.transforms.w3c;else{var i=["Moz","webkit","O","ms","Khtml"],e=0;for(e=0;e<i.length;e++)if(i[e]+"Transform"in document.documentElement.style){this.transform=this.transforms[i[e]];break}}if(this.transform){this.bugs=[];var s="multiply"===this.options.mouseOver?this.options.minBugs:this.random(this.options.minBugs,this.options.maxBugs,!0),e=0,n=this;for(e=0;e<s;e++){var t=JSON.parse(JSON.stringify(this.options)),o=SpawnBug();t.wingsOpen=!this.options.canFly||.5<Math.random(),t.walkSpeed=this.random(this.options.minSpeed,this.options.maxSpeed),o.initialize(this.transform,t),this.bugs.push(o)}for(this.spawnDelay=[],e=0;e<s;e++){var h=this.random(this.options.minDelay,this.options.maxDelay,!0),a=this.bugs[e];this.spawnDelay[e]=setTimeout(function(t){return function(){n.options.canFly?t.flyIn():t.walkIn()}}(a),h),n.add_events_to_bug(a)}this.options.monitorMouseMovement&&(window.onmousemove=function(){n.check_if_mouse_close_to_bug()})}else console.log("Transforms are not supported in this browser; quitting.")},stop:function(){for(var t=0;t<this.bugs.length;t++)this.spawnDelay[t]&&clearTimeout(this.spawnDelay[t]),this.bugs[t].stop()},end:function(){for(var t=0;t<this.bugs.length;t++)this.spawnDelay[t]&&clearTimeout(this.spawnDelay[t]),this.bugs[t].stop(),this.bugs[t].remove()},reset:function(){this.stop();for(var t=0;t<this.bugs.length;t++)this.bugs[t].reset(),this.bugs[t].walkIn()},killAll:function(){for(var t=0;t<this.bugs.length;t++)this.spawnDelay[t]&&clearTimeout(this.spawnDelay[t]),this.bugs[t].die()},add_events_to_bug:function(i){var e=this;i.bug&&(i.bug.addEventListener?i.bug.addEventListener("mouseover",function(t){e.on_bug(i)}):i.bug.attachEvent&&i.bug.attachEvent("onmouseover",function(t){e.on_bug(i)}))},check_if_mouse_close_to_bug:function(t){if(t=t||window.event)for(var i=0,e=0,s=(t.client&&t.client.x?(i=t.client.x,e=t.client.y):t.clientX?(i=t.clientX,e=t.clientY):t.page&&t.page.x?(i=t.page.x-(document.body.scrollLeft+document.documentElement.scrollLeft),e=t.page.y-(document.body.scrollTop+document.documentElement.scrollTop)):t.pageX&&(i=t.pageX-(document.body.scrollLeft+document.documentElement.scrollLeft),e=t.pageY-(document.body.scrollTop+document.documentElement.scrollTop)),this.bugs.length),n=0,n=0;n<s;n++){var o=this.bugs[n].getPos();o&&Math.abs(o.top-e)+Math.abs(o.left-i)<this.options.eventDistanceToBug&&!this.bugs[n].flyperiodical&&this.near_bug(this.bugs[n])}},near_bug:function(t){this.on_bug(t)},on_bug:function(t){var i,e,s,n;t.alive&&("fly"===(e="random"===(e=this.options.mouseOver)?this.modes[this.random(0,this.modes.length-1,!0)]:e)?(t.stop(),t.flyRand()):"nothing"!==e&&("flyoff"===e?(t.stop(),t.flyOff()):"die"===e?t.die():"multiply"===e&&!this.multiplyDelay&&this.bugs.length<this.options.maxBugs&&(i=SpawnBug(),e=JSON.parse(JSON.stringify(this.options)),s=t.getPos(),e.wingsOpen=!(n=this).options.canFly||.5<Math.random(),e.walkSpeed=this.random(this.options.minSpeed,this.options.maxSpeed),i.initialize(this.transform,e),i.drawBug(s.top,s.left),e.canFly?(i.flyRand(),t.flyRand()):(i.go(),t.go()),this.bugs.push(i),this.multiplyDelay=!0,setTimeout(function(){n.add_events_to_bug(i),n.multiplyDelay=!1},this.options.minTimeBetweenMultipy))))},random:function(t,i,e){var s;return t==i?e?Math.round(t):t:(i<(s=t-.5+Math.random()*(i-t+1))?s=i:s<t&&(s=t),e?Math.round(s):s)}},BugController=function(){this.initialize.apply(this,arguments)},SpiderController=(BugController.prototype=BugDispatch,function(){this.options=mergeOptions(this.options,{imageSprite:"spider-sprite.png",bugWidth:69,bugHeight:90,num_frames:7,canFly:!1,canDie:!0,numDeathTypes:2,zoom:6,minDelay:200,maxDelay:3e3,minSpeed:6,maxSpeed:13,minBugs:3,maxBugs:10}),this.initialize.apply(this,arguments)}),LadybugController=(SpiderController.prototype=BugDispatch,function(){this.options=mergeOptions(this.options,{imageSprite:"ladybug-sprite.png",bugWidth:69,bugHeight:90,num_frames:7,canFly:!1,canDie:!0,numDeathTypes:2,zoom:6,minDelay:200,maxDelay:3e3,minSpeed:7,maxSpeed:14,minBugs:2,maxBugs:4}),this.initialize.apply(this,arguments)}),Bug=(LadybugController.prototype=BugDispatch,{options:{wingsOpen:!1,walkSpeed:2,flySpeed:40,edge_resistance:50,zoom:10},initialize:function(t,i){this.options=mergeOptions(this.options,i),this.NEAR_TOP_EDGE=1,this.NEAR_BOTTOM_EDGE=2,this.NEAR_LEFT_EDGE=4,this.NEAR_RIGHT_EDGE=8,this.directions={},this.directions[this.NEAR_TOP_EDGE]=270,this.directions[this.NEAR_BOTTOM_EDGE]=90,this.directions[this.NEAR_LEFT_EDGE]=0,this.directions[this.NEAR_RIGHT_EDGE]=180,this.directions[this.NEAR_TOP_EDGE+this.NEAR_LEFT_EDGE]=315,this.directions[this.NEAR_TOP_EDGE+this.NEAR_RIGHT_EDGE]=225,this.directions[this.NEAR_BOTTOM_EDGE+this.NEAR_LEFT_EDGE]=45,this.directions[this.NEAR_BOTTOM_EDGE+this.NEAR_RIGHT_EDGE]=135,this.angle_deg=0,this.angle_rad=0,this.large_turn_angle_deg=0,this.near_edge=!1,this.edge_test_counter=10,this.small_turn_counter=0,this.large_turn_counter=0,this.fly_counter=0,this.toggle_stationary_counter=50*Math.random(),this.zoom=this.random(this.options.zoom,10)/10,this.stationary=!1,this.bug=null,this.active=!0,this.wingsOpen=this.options.wingsOpen,this.transform=t,this.walkIndex=0,this.flyIndex=0,this.alive=!0,this.twitchTimer=null,this.rad2deg_k=180/Math.PI,this.deg2rad_k=Math.PI/180,this.makeBug(),this.angle_rad=this.deg2rad(this.angle_deg),this.angle_deg=this.random(0,360,!0)},go:function(){var i;this.transform&&(this.drawBug(),(i=this).animating=!0,this.going=requestAnimFrame(function(t){i.animate(t)}))},stop:function(){this.animating=!1,this.going&&(clearTimeout(this.going),this.going=null),this.flyperiodical&&(clearTimeout(this.flyperiodical),this.flyperiodical=null),this.twitchTimer&&(clearTimeout(this.twitchTimer),this.twitchTimer=null)},remove:function(){this.active=!1,this.inserted&&this.bug.parentNode&&(this.bug.parentNode.removeChild(this.bug),this.inserted=!1)},reset:function(){this.alive=!0,this.active=!0,this.bug.style.bottom="",this.bug.style.top=0,this.bug.style.left=0,this.bug.classList.remove("bug-dead")},animate:function(t){var i,e,s;this.animating&&this.alive&&this.active&&((i=this).going=requestAnimFrame(function(t){i.animate(t)}),"_lastTimestamp"in this||(this._lastTimestamp=t),(e=t-this._lastTimestamp)<40||(200<e&&(e=200),this._lastTimestamp=t,--this.toggle_stationary_counter<=0&&this.toggleStationary(),this.stationary)||(--this.edge_test_counter<=0&&this.bug_near_window_edge()&&(this.angle_deg%=360,this.angle_deg<0&&(this.angle_deg+=360),15<Math.abs(this.directions[this.near_edge]-this.angle_deg))&&(t=this.directions[this.near_edge]-this.angle_deg,s=360-this.angle_deg+this.directions[this.near_edge],this.large_turn_angle_deg=Math.abs(t)<Math.abs(s)?t:s,this.edge_test_counter=10,this.large_turn_counter=100,this.small_turn_counter=30),--this.large_turn_counter<=0&&(this.large_turn_angle_deg=this.random(1,this.options.maxLargeTurnDeg,!0),this.next_large_turn()),--this.small_turn_counter<=0?(this.angle_deg+=this.random(1,this.options.maxSmallTurnDeg),this.next_small_turn()):(t=this.random(1,this.options.maxWiggleDeg,!0),(0<this.large_turn_angle_deg&&t<0||this.large_turn_angle_deg<0&&0<t)&&(t=-t),this.large_turn_angle_deg-=t,this.angle_deg+=t),this.angle_rad=this.deg2rad(this.angle_deg),s=Math.cos(this.angle_rad)*this.options.walkSpeed*(e/100),t=-Math.sin(this.angle_rad)*this.options.walkSpeed*(e/100),this.moveBug(this.bug.left+s,this.bug.top+t,90-this.angle_deg),this.walkFrame()))},makeBug:function(){var t,i;!this.bug&&this.active&&(t=this.wingsOpen?"0":"-"+this.options.bugHeight+"px",(i=document.createElement("div")).className="bug",i.style.background="transparent url("+this.options.imageSprite+") no-repeat 0 "+t,i.style.width=this.options.bugWidth+"px",i.style.height=this.options.bugHeight+"px",i.style.position="fixed",i.style.top=0,i.style.left=0,i.style.zIndex="9999999",this.bug=i,this.setPos())},setPos:function(t,i){this.bug.top=t||this.random(this.options.edge_resistance,document.documentElement.clientHeight-this.options.edge_resistance),this.bug.left=i||this.random(this.options.edge_resistance,document.documentElement.clientWidth-this.options.edge_resistance),this.moveBug(this.bug.left,this.bug.top,90-this.angle_deg)},moveBug:function(t,i,e){this.bug.left=t,this.bug.top=i;t="translate("+parseInt(t)+"px,"+parseInt(i)+"px)";e&&(t+=" rotate("+e+"deg)"),t+=" scale("+this.zoom+")",this.transform(t)},drawBug:function(t,i){this.bug||this.makeBug(),this.bug&&(t&&i?this.setPos(t,i):this.setPos(this.bug.top,this.bug.left),this.inserted||(this.inserted=!0,document.body.appendChild(this.bug)))},toggleStationary:function(){this.stationary=!this.stationary,this.next_stationary();var t=this.wingsOpen?"0":"-"+this.options.bugHeight+"px";this.stationary?this.bug.style.backgroundPosition="0 "+t:this.bug.style.backgroundPosition="-"+this.options.bugWidth+"px "+t},walkFrame:function(){var t=this.walkIndex*this.options.bugWidth*-1+"px",i=this.wingsOpen?"0":"-"+this.options.bugHeight+"px";this.bug.style.backgroundPosition=t+" "+i,this.walkIndex++,this.walkIndex>=this.options.num_frames&&(this.walkIndex=0)},fly:function(t){var i,e=this.bug.top,s=this.bug.left,n=s-t.left,o=e-t.top,h=Math.atan(o/n);Math.abs(n)+Math.abs(o)<50&&(this.bug.style.backgroundPosition=-2*this.options.bugWidth+"px -"+2*this.options.bugHeight+"px"),Math.abs(n)+Math.abs(o)<30&&(this.bug.style.backgroundPosition=-1*this.options.bugWidth+"px -"+2*this.options.bugHeight+"px"),Math.abs(n)+Math.abs(o)<10?(this.bug.style.backgroundPosition="0 0",this.stop(),this.go()):(i=Math.cos(h)*this.options.flySpeed,h=Math.sin(h)*this.options.flySpeed,(s>t.left&&0<i||s>t.left&&i<0)&&(i*=-1,Math.abs(n)<Math.abs(i))&&(i/=4),(e<t.top&&h<0||e>t.top&&0<h)&&(h*=-1,Math.abs(o)<Math.abs(h))&&(h/=4),this.moveBug(s+i,e+h))},flyRand:function(){this.stop();var t={};t.top=this.random(this.options.edge_resistance,document.documentElement.clientHeight-this.options.edge_resistance),t.left=this.random(this.options.edge_resistance,document.documentElement.clientWidth-this.options.edge_resistance),this.startFlying(t)},startFlying:function(t){var i=this.bug.top,e=this.bug.left,s=t.left-e,n=t.top-i,o=(this.bug.left=t.left,this.bug.top=t.top,this.angle_rad=Math.atan(n/s),this.angle_deg=this.rad2deg(this.angle_rad),this.angle_deg=0<s?90+this.angle_deg:270+this.angle_deg,this.moveBug(e,i,this.angle_deg),this);this.flyperiodical=setInterval(function(){o.fly(t)},10)},flyIn:function(){var t,i,e,s;this.bug||this.makeBug(),this.bug&&(this.stop(),e=Math.round(4*Math.random()-.5),t=(i=document).documentElement,i=i.getElementsByTagName("body")[0],s=window.innerWidth||t.clientWidth||i.clientWidth,t=window.innerHeight||t.clientHeight||i.clientHeight,i={},0===(e=(e=3<e?3:e)<0?0:e)?(i.top=-2*this.options.bugHeight,i.left=Math.random()*s):1===e?(i.top=Math.random()*t,i.left=s+2*this.options.bugWidth):2===e?(i.top=t+2*this.options.bugHeight,i.left=Math.random()*s):(i.top=Math.random()*t,i.left=-3*this.options.bugWidth),e=this.wingsOpen?"0":"-"+this.options.bugHeight+"px",this.bug.style.backgroundPosition=-3*this.options.bugWidth+"px "+e,this.bug.top=i.top,this.bug.left=i.left,this.drawBug(),(s={}).top=this.random(this.options.edge_resistance,document.documentElement.clientHeight-this.options.edge_resistance),s.left=this.random(this.options.edge_resistance,document.documentElement.clientWidth-this.options.edge_resistance),this.startFlying(s))},walkIn:function(){var t,i,e,s;this.bug||this.makeBug(),this.bug&&(this.stop(),s=Math.round(4*Math.random()-.5),i=(e=document).documentElement,e=e.getElementsByTagName("body")[0],t=window.innerWidth||i.clientWidth||e.clientWidth,i=window.innerHeight||i.clientHeight||e.clientHeight,e={},0===(s=(s=3<s?3:s)<0?0:s)?(e.top=-1.3*this.options.bugHeight,e.left=Math.random()*t):1===s?(e.top=Math.random()*i,e.left=t+.3*this.options.bugWidth):2===s?(e.top=i+.3*this.options.bugHeight,e.left=Math.random()*t):(e.top=Math.random()*i,e.left=-1.3*this.options.bugWidth),s=this.wingsOpen?"0":"-"+this.options.bugHeight+"px",this.bug.style.backgroundPosition=-3*this.options.bugWidth+"px "+s,this.bug.top=e.top,this.bug.left=e.left,this.drawBug(),this.go())},flyOff:function(){this.stop();var t=this.random(0,3),i={},e=document,s=e.documentElement,e=e.getElementsByTagName("body")[0],n=window.innerWidth||s.clientWidth||e.clientWidth,s=window.innerHeight||s.clientHeight||e.clientHeight;0===t?(i.top=-200,i.left=Math.random()*n):1===t?(i.top=Math.random()*s,i.left=n+200):2===t?(i.top=s+200,i.left=Math.random()*n):(i.top=Math.random()*s,i.left=-200),this.startFlying(i)},die:function(){this.stop();var t=this.random(0,this.options.numDeathTypes-1);this.alive=!1,this.drop(t)},drop:function(i){var e=this.bug.top,t=document,s=t.documentElement,t=t.getElementsByTagName("body")[0],n=(window.innerHeight||s.clientHeight||t.clientHeight)-this.options.bugHeight,o=this.random(0,20,!0),h=(Date.now(),this);this.bug.classList.add("bug-dead"),this.dropTimer=requestAnimFrame(function(t){h._lastTimestamp=t,h.dropping(t,e,n,o,i)})},dropping:function(t,i,e,s,n){var o,h,t=t-this._lastTimestamp,a=i+t*t*.002,g=this;e<=a?(a=e,clearTimeout(this.dropTimer),this.angle_deg=0,this.angle_rad=this.deg2rad(this.angle_deg),this.transform("rotate("+(90-this.angle_deg)+"deg) scale("+this.zoom+")"),this.bug.style.top=null,o=(this.options.bugWidth*this.zoom-this.options.bugHeight*this.zoom)/2,h=this.options.bugHeight/2*(1-this.zoom),this.bug.style.bottom=Math.ceil(o-h)+"px",this.bug.style.left=this.bug.left+"px",this.bug.style.backgroundPosition="-"+2*n*this.options.bugWidth+"px 100%",this.twitch(n)):(this.dropTimer=requestAnimFrame(function(t){g.dropping(t,i,e,s,n)}),t<20||(this.angle_deg=(this.angle_deg+s)%360,this.angle_rad=this.deg2rad(this.angle_deg),this.moveBug(this.bug.left,a,this.angle_deg)))},twitch:function(t,i){i=i||0;var e=this;0!==t&&1!==t||(e.twitchTimer=setTimeout(function(){e.bug.style.backgroundPosition="-"+(2*t+i%2)*e.options.bugWidth+"px 100%",e.twitchTimer=setTimeout(function(){i++,e.bug.style.backgroundPosition="-"+(2*t+i%2)*e.options.bugWidth+"px 100%",e.twitch(t,++i)},e.random(300,800))},this.random(1e3,1e4)))},rad2deg:function(t){return t*this.rad2deg_k},deg2rad:function(t){return t*this.deg2rad_k},random:function(t,i,e){return t==i?t:(i=Math.round(t-.5+Math.random()*(i-t+1)),!e||.5<Math.random()?i:-i)},next_small_turn:function(){this.small_turn_counter=Math.round(10*Math.random())},next_large_turn:function(){this.large_turn_counter=Math.round(40*Math.random())},next_stationary:function(){this.toggle_stationary_counter=this.random(50,300)},bug_near_window_edge:function(){return this.near_edge=0,this.bug.top<this.options.edge_resistance?this.near_edge|=this.NEAR_TOP_EDGE:this.bug.top>document.documentElement.clientHeight-this.options.edge_resistance&&(this.near_edge|=this.NEAR_BOTTOM_EDGE),this.bug.left<this.options.edge_resistance?this.near_edge|=this.NEAR_LEFT_EDGE:this.bug.left>document.documentElement.clientWidth-this.options.edge_resistance&&(this.near_edge|=this.NEAR_RIGHT_EDGE),this.near_edge},getPos:function(){return this.inserted&&this.bug&&this.bug.style?{top:parseInt(this.bug.top,10),left:parseInt(this.bug.left,10)}:null}}),SpawnBug=function(){var t,i={};for(t in Bug)Bug.hasOwnProperty(t)&&(i[t]=Bug[t]);return i},mergeOptions=function(t,i,e){var s,n=(e=void 0===e?!0:e)?cloneOf(t):t;for(s in i)i.hasOwnProperty(s)&&(n[s]=i[s]);return n},cloneOf=function(t){if(null==t||"object"!=typeof t)return t;var i,e=t.constructor();for(i in t)t.hasOwnProperty(i)&&(e[i]=cloneOf(t[i]));return e};window.requestAnimFrame=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(t,i){window.setTimeout(t,1e3/60)};